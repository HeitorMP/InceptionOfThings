#!/bin/bash
set -e

USER_NAME="iot"

echo "=== Setup P1: Multi-node K3s cluster ==="
echo "=== Applying network configuration ==="

# Define network from p1/network.xml
NETWORK_XML="$(dirname "$0")/network.xml"

if [ ! -f "$NETWORK_XML" ]; then
    echo "❌ Network file not found: $NETWORK_XML"
    exit 1
fi

# Apply network configuration
sudo virsh net-define "$NETWORK_XML" || true
sudo virsh net-start vagrant-libvirt || true
sudo virsh net-autostart vagrant-libvirt || true

echo "✅ Network configured"
echo ""
echo "Now you can start the VMs with:"
echo "   cd $(dirname "$0")"
echo "   vagrant up --provider=libvirt"